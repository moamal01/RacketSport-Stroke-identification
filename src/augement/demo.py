import cv2
import json

# File paths
json_path = "data/events/events_markup2.json"
video_path = "videos/game_2.mp4"

width = 1920
height = 1080

cap = cv2.VideoCapture(video_path)
cap.set(cv2.CAP_PROP_POS_FRAMES, 874)
ret, frame = cap.read()
flipped_image = cv2.flip(frame, 1)

keypoints = [
    [0.25478248596191405, 0.4202563250506366, 1.6208348274230957],
    [0.2562754472096761, 0.4122784649884259, 1.5391968488693237],
    [0.25030357042948403, 0.4122784649884259, 1.8986066579818726],
    [0.25478248596191405, 0.4136080989131221, 0.18661531805992126],
    [0.2338808536529541, 0.41493776109483504, 0.9011067152023315],
    [0.25254300435384114, 0.46014568187572336, 0.4307704269886017],
    [0.21447219848632812, 0.46812354193793404, 0.20009346306324005],
    [0.24433167775472006, 0.5213094075520833, 0.10978701710700989],
    [0.2040213902791341, 0.5412541142216435, 0.2530951499938965],
    [0.25702191988627116, 0.5532209043149595, 0.043758735060691833],
    [0.23612031936645508, 0.5545505664966724, 0.32734742760658264],
    [0.23313438097635905, 0.5784841466833044, 0.1457304060459137],
    [0.2032749017079671, 0.5811434710467304, 0.1126706600189209],
    [0.25702191988627116, 0.646296070240162, 0.318049818277359],
    [0.19804948170979816, 0.6675704390914352, 0.36623135209083557],
    [0.2607543627421061, 0.7313934326171875, 0.3877142071723938],
    [0.17565488815307617, 0.7699531837745949, 0.3497350215911865],
    [0.8940621058146159, 0.5012980143229167, 0.16294200718402863],
    [0.8716227849324544, 0.48265471281828703, 0.2642267644405365],
    [0.8873303095499675, 0.4839864095052083, 0.17397364974021912],
    [0.8753626505533855, 0.47865979229962385, 0.3528960347175598],
    [0.9112655639648437, 0.4813230726453993, 0.4500856399536133],
    [0.8589071273803711, 0.5146145855938947, 0.33609431982040405],
    [0.9419326782226562, 0.5092879683883101, 0.27347105741500854],
    [0.8200122197469075, 0.6158207646122685, 0.7515013813972473],
    [0.9927952448527019, 0.5825292516637731, 0.3200427293777466],
    [0.8476874669392903, 0.6610972086588541, 0.21869859099388123],
    [0.9651201248168946, 0.594514239275897, 0.05337424576282501],
    [0.8701267878214518, 0.7143636632848669, 0.10579903423786163],
    [0.9337050120035807, 0.7316752681025752, 0.10479053109884262],
    [0.8237521489461263, 0.8195648193359375, 0.5154588222503662],
    [0.9389408111572266, 0.9101177074291088, 0.3446838855743408],
    [0.7990688959757487, 0.9420775802047164, 0.4257349669933319],
    [0.9456726710001627, 0.9860223840784144, 0.2503716051578522]
]

bboxes = [
    [0.16930975914001464, 0.37438357317889176, 0.28576167424519855, 0.8091777095088253],
    [0.772515614827474, 0.43271747165256075, 0.9931692759195964, 0.9880199291087963],
    [0.2345255215962728, 0.5771943834092882, 0.8065534591674804, 0.9279281051070601],
    [0.22346059481302896, 0.5454999570493345, 0.2661206086476644, 0.5815984655309606]
]

for keypoint in keypoints:
    x, y, _ = keypoint
    x_pixel = int(x * width)
    y_pixel = int(y * height)
    
    cv2.circle(frame, (x_pixel, y_pixel), radius=1, color=(0, 255, 0), thickness=-1)
    
for bbox in bboxes:
    xmin, ymin, xmax, ymax = bbox
    xmin_pixel = int(xmin * width)
    ymin_pixel = int(ymin * height)
    xmax_pixel = int(xmax * width)
    ymax_pixel = int(ymax * height)
    
    cv2.rectangle(frame, (xmin_pixel, ymin_pixel), (xmax_pixel, ymax_pixel), color=(0, 255, 0), thickness=1)


cv2.imshow(f"Event Preview (Frame {int(cap.get(cv2.CAP_PROP_POS_FRAMES))})", frame)
cv2.waitKey(0)

# Mirrored
for keypoint in keypoints:
    x, y, _ = keypoint
    x = 1 - x
    
    cv2.circle(flipped_image, (int(x * width), int(y * height)), radius=1, color=(0, 255, 0), thickness=-1)


for bbox in bboxes:
    xmin, ymin, xmax, ymax = bbox
    xmin_pixel = 1 - xmin
    xmax_pixel = 1 - xmax
    
    cv2.rectangle(flipped_image, (int(xmin_pixel * width), int(ymin * height)), (int(xmax_pixel * width), int(ymax * height)), color=(0, 255, 0), thickness=1)


cv2.imshow(f"Event Preview (Frame {int(cap.get(cv2.CAP_PROP_POS_FRAMES))})", flipped_image)
cv2.waitKey(0)